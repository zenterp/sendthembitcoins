<script type='text/template' id='invoiceTemplate'>
  <p style='font-size:200%;line-height:150%;text-align:center;'>Click the button to send {{= bitcoinAmount }} bitcoins to @{{= twitterUsername }} on twitter<p>
</script>

<form method='post' id='newInvoice' style='margin-top:150px; text-align:center; font-size:150%' novalidate>
  <p style='color:white; text-align:center;'>Twitter Username of Recipeient:</p>
  <input name='twitterRecipient' step='0.001' min='0.001' required='true'style='padding:5px; padding-left:10px;font-size:120%;margin-top:20px;margin-bottom:50px' type='text'></input>

  <p style='padding:20px;'>
    <input type='number' style='width:25%;float:left;' name='amountInBitcoins'></input>
    # of Bitcoins to Send
  </p>

  <br/><br/>

  <input type='submit' value='generate invoice' style='font-size:100%;padding:10px;' class='button button-large'></input>
</form>

<div id='invoice' style='margin-top:100px;margin-left:auto;margin-right:auto;height:300px;'></div>

<% content_for :javascripts do %>
  <script>
    $(function(){
      _.templateSettings = {
          interpolate: /\{\{\=(.+?)\}\}/g,
          evaluate: /\{\{(.+?)\}\}/g
      };
      var invoiceTemplate = _.template($("#invoiceTemplate").html());
  
      window.showInvoice = function(invoice){
        $("#invoice").append(
          invoiceTemplate({ 
            twitterUsername: invoice.recipient_twitter_username,
            bitcoinAmount: invoice.bitcoin_amount
          })); 

      }

      window.createInvoice = function(twitterUsername, bitcoinAmount){
        $.ajax({
          type: 'POST',
          url: '/api/invoices',
          data: {
            twitterUsername: twitterUsername,
            bitcoin_amount: bitcoinAmount
          },
          success: function(invoice){
            console.log(invoice);
            showInvoice(invoice);
            $("#invoice").append(invoice.invoice_button.embed_html); 
            $("form").remove();
          },
          error: function(err){
            console.log(err);
          }
        })
      };
  
      $('#newInvoice').on('submit', function(e){
        e.preventDefault();
        createInvoice('stevenzeiler',0.01);
      })
    })
  </script>
<% end %>